#! /usr/bin/env python
# coding=utf-8

from __future__ import print_function
import optparse
import sys

PY3 = sys.version_info[0] == 3


def _process_line(input_file, output_file, lambda_string):
    if input_file is None:
        lines = sys.stdin.readlines()
    else:
        lines = open(input_file, 'r').readlines()

    func = eval(lambda_string)

    for i in range(0, len(lines)):
        lines[i] = func(lines[i])

    if output_file is None:
        out = sys.stdout
    else:
        out = open(output_file, 'w')
    for line in lines:
        # here we use the completely-override-write to make it's easy to implement in-place edit
        out.write(line)


def main():
    parser = optparse.OptionParser('usage %prog -l <Python Lambda Expression> [Input File] [Output File] ')
    parser.add_option('-l', dest='lambda_string', type='string', help='lambda x:x.something(), here we assume x is str')
    options, args = parser.parse_args()
    if options.lambda_string is None:
        print (parser.usage)
        exit(1)
    else:
        _process_line(args[0], args[1] if len(args) > 1 else None, options.lambda_string)


if __name__ == '__main__':
    main()

